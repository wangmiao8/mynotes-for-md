# ç°ä»£æ¨¡å—åŒ–æœºåˆ¶

æ¨¡å—åŒ–çš„å¥½å¤„ï¼š

1. é¿å…å‘½åå†²çª
1. ä»£ç ç»“æ„åˆ†ç¦»ï¼Œé«˜å¯ç»´æŠ¤æ€§ã€é«˜å¯å¤ç”¨æ€§
1. æŒ‰éœ€åŠ è½½

### å‰ç«¯æ¨¡å—åŒ–çš„æ¼”å˜

function æ¨¡å¼ -> å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ -> è‡ªæ‰§è¡Œå‡½æ•°ï¼ˆIIFEï¼‰ -> IIFE å¢å¼º -> CommonJSã€AMDã€CMDã€ES6 æ¨¡å—åŒ–

#### 1. å…¨å±€çš„ function æ¨¡å¼

```javascript
function foo1() {
  // do something â€¦
}

function foo2() {
  // do something â€¦
}
```

åˆ©ç”¨äº†å‡½æ•°ä½œç”¨åŸŸçš„ç‰¹æ€§æ¥åˆ†å‰²å˜é‡å’Œå®ç°ä¸åŒçš„åŠŸèƒ½

**ç¼ºç‚¹ï¼š** å‡½æ•°éƒ½å£°æ˜åœ¨äº†å…¨å±€ç¯å¢ƒä¸‹ï¼Œæ±¡æŸ“å…¨å±€å˜é‡

#### 2. å‘½åç©ºé—´ï¼ˆnamespaceï¼‰æ¨¡å¼

```javascript
const module = {
  data: 1,
  sayName: function(name) {
    console.log('hello, ' + name)
  },
  add: function(num1, num2) {
    return num1 + num2
  }
}

module.data = 2  // ä¿®æ”¹äº† module ä¸­çš„æ•°æ®
module.sayName('noko')
```

å°†å˜é‡å’Œå‡½æ•°ä½œä¸ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œæ•´åˆèµ·æ¥çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œ

**ç¼ºç‚¹ï¼š** æ•°æ®ä¸å®‰å…¨ï¼Œå®¹æ˜“ç¯¡æ”¹æ¨¡å—å¯¹è±¡ä¸­çš„æ•°æ®å’Œæ–¹æ³•

#### 3. è‡ªæ‰§è¡Œå‡½æ•°ï¼ˆIIFEï¼‰å’Œé—­åŒ…

```javascript
(function(window){
  let data = 1

  const setData = (newData) => {
    data = newData
  }

  const getData = () => console.log(data)

  window.module = {
    setData,
    getData
  }
})(window)

module.getData() // 1
module.setData(2) 
module.getData() // 2
```

æ•°æ®ç§æœ‰åŒ–ï¼Œå¤–éƒ¨åªèƒ½é€šè¿‡æš´éœ²çš„æ–¹æ³•è·å–å’Œä¿®æ”¹

**ç¼ºç‚¹ï¼š** æ²¡æœ‰å¼•å…¥ä¾èµ–çš„æœºåˆ¶

#### 4. Â IIFE å¢å¼ºç‰ˆ â€”â€” ç°ä»£æ¨¡å—åŒ–çš„åŸºç¡€

```javascript
// module.js æ–‡ä»¶
(function(window, $){
  let data = 1

  const setData = (newData) => {
    data = newData
  }

  const getData = () => console.log(data)

  const changeColor = () => {
    $('body').css('background', 'red')
  }

  window.module = {
    setData,
    getData,
    changeColor
  }
})(window, jQuery)

window.changeColor()
```

æ¨¡å—äº’ç›¸ç‹¬ç«‹ï¼Œæ¨¡å—ä¹Ÿå¯ä»¥å¼•è¿›å¦å¤–ä¸€ä¸ªæ¨¡å—ï¼Œä¾èµ–å…³ç³»æ¸…æ™°

**ç¼ºç‚¹ï¼š** å¼•å…¥å…¶ä»–æ¨¡å—æˆ–è€…ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œè¦æ³¨æ„å¼•å…¥çš„å…ˆåé¡ºåº

```javascript
// html æ–‡ä»¶æŒ‰é¡ºåºå¼•å…¥
<script type="text/javascript" src="jquery-1.10.1.js"></script>
<script type="text/javascript" src="module.js"></script> <script type="text/javascript"> 
  module.changeColor()
</script>
```

### å‰ç«¯ç°ä»£æ¨¡å—åŒ–

å‰ç«¯ç›®å‰æ¨¡å—åŒ–è§„èŒƒï¼šCommonJSã€AMDã€ES6 æ¨¡å—åŒ–ã€CMD

#### CommonJS

ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—é—´æ•°æ®äº’ç›¸ç‹¬ç«‹ã€‚

åœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿è¡Œæ—¶åŒæ­¥åŠ è½½æ¨¡å—ï¼›æµè§ˆå™¨ç«¯ï¼Œæ¨¡å—éœ€ç¼–è¯‘å¤„ç†ã€‚

**ç®€è¿°ï¼š**

å››ä¸ªé‡è¦å¯¹è±¡ï¼š

1. module

æ¯ä¸ªæ¨¡å—å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª module å¯¹è±¡

> module.id æ¨¡å—çš„è¯†åˆ«ç¬¦ï¼Œé€šå¸¸æ˜¯å¸¦æœ‰ç»å¯¹è·¯å¾„çš„æ¨¡å—æ–‡ä»¶åã€‚
> module.filename æ¨¡å—çš„æ–‡ä»¶åï¼Œå¸¦æœ‰ç»å¯¹è·¯å¾„ã€‚
> module.loaded è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ¨¡å—æ˜¯å¦å·²ç»å®ŒæˆåŠ è½½ã€‚
> module.parent è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºè°ƒç”¨è¯¥æ¨¡å—çš„æ¨¡å—ã€‚
> module.children è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºè¯¥æ¨¡å—è¦ç”¨åˆ°çš„å…¶ä»–æ¨¡å—ã€‚
> module.exports è¡¨ç¤ºæ¨¡å—å¯¹å¤–è¾“å‡ºçš„å€¼ã€‚

2. exports

exports æ˜¯ `module.exports` Â çš„å¼•ç”¨ï¼ŒæŒ‡å‘ module å¯¹è±¡ä¸‹çš„å±æ€§ exportsï¼Œç›¸å½“äº

```javascript
var exports = module.exports;
```

é¿å…ä»¥ä¸‹å¼•èµ· exports ç›´æ¥å¤åˆ¶ï¼Œåˆ‡æ–­äº†ä¸ module.exports çš„è”ç³»

```javascript
exports.hello = function() {
  return 'hello';
};

module.exports = 'Hello world';
```

**ä¸å»ºè®®ä½¿ç”¨ exportsï¼Œå»ºè®®ä½¿ç”¨ module.exports å¯¼å‡ºæ¨¡å—ã€‚**

3. require

> ç”¨äºåŠ è½½ module.exports çš„æ¨¡å—

4. global

> æ‰€æœ‰æ¨¡å—éƒ½èƒ½è®¿é—®åˆ° global å¯¹è±¡

**ä½¿ç”¨çš„åœºæ™¯ï¼š** Node.jsã€å°ç¨‹åºã€æµè§ˆå™¨ï¼ˆBrowserifyï¼‰

**ç‰¹ç‚¹ï¼š**

1. è¿è¡Œæ—¶åŠ è½½ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡åŠ è½½æ¨¡å—åä¼šè¢«ç¼“å­˜

```javascript
require('./example.js');  // ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œå¼€å§‹åŠ è½½ï¼Œå¹¶ä¸”ç¼“å­˜åˆ° require.cache å¯¹è±¡

require('./example.js').message = 'hello';
require('./example.js').message
```

ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œå¼€å§‹åŠ è½½ï¼Œå¹¶ä¸”ç¼“å­˜åˆ° Â `require.cache` Â å¯¹è±¡ï¼Œæ‰€æœ‰çš„æ¨¡å—ç¼“å­˜éƒ½åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ã€‚

2. åŒæ­¥åŠ è½½æ¨¡å—

```javascript
var a = require('./a') // æ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œa.js æ‰åŒæ­¥ä¸‹è½½å¹¶æ‰§è¡Œ
```

ç”±äº CommonJS åŒæ­¥åŠ è½½çš„æ–¹å¼ï¼Œåœ¨æµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨ browserifyï¼Œä½†åŒæ­¥æ„å‘³ç€é˜»å¡åŠ è½½ï¼Œæ‰€ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒå¹¶ä¸é€‚ç”¨ï¼›è€ŒæœåŠ¡å™¨æ–‡ä»¶éƒ½åœ¨åœ¨æœ¬åœ°ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼ŒCommonJS æ˜¯é€‚ç”¨çš„ã€‚

**ä¸¾ä¸€ä¸ªæ —å­ğŸŒ°ï¼š**

```javascript
// å®šä¹‰æ¨¡å—math.js
var basicNum = 0;
function add(a, b) {
  return a + b;
}
module.exports = { //åœ¨è¿™é‡Œå†™ä¸Šéœ€è¦å‘å¤–æš´éœ²çš„å‡½æ•°ã€å˜é‡
  add: add,
  basicNum: basicNum
}

// å¼•ç”¨è‡ªå®šä¹‰çš„æ¨¡å—æ—¶ï¼Œå‚æ•°åŒ…å«è·¯å¾„ï¼Œå¯çœç•¥.js
var math = require('./math');
math.add(2, 5);

// å¼•ç”¨æ ¸å¿ƒæ¨¡å—æ—¶ï¼Œä¸éœ€è¦å¸¦è·¯å¾„
var http = require('http');
http.createService(...).listen(3000);
```
